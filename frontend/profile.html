<body>
  <h2 id="welcome">Loading...</h2>
  <p id="user-id"></p>
  <p id="user-email"></p>

  <button id="promote-btn">Register as Organizer</button>

  <script>
    const token = localStorage.getItem("token");

    fetch("http://localhost:5000/api/dashboard", {
      headers: {
        Authorization: "Bearer " + token,
      },
    })
      .then((res) => {
        if (res.status == 401) {
          localStorage.removeItem("token");
          window.location.href = "/login.html";
        } else {
          return res.json();
        }
      })
      .then((data) => {
        console.log(data);
        document.getElementById("welcome").innerText = data.message;
        document.getElementById("user-id").innerText =
          "User ID: " + data.user._id;
        document.getElementById("user-email").innerText =
          "Email ID: " + data.user.email;
      })
      .catch((err) => {
        alert("Access denied. Please login.");
        window.location.href = "/login.html";
      });

    document
      .getElementById("promote-btn")
      .addEventListener("click", async () => {
        try {
          console.log("in button handler");
          const res = await fetch("http://localhost:5000/api/promote", {
            method: "POST",
            headers: {
              Authorization: "Bearer " + token,
            },
          });
          console.log("after button handler");
          const result = await res.json();
          alert(result.message);
        } catch (err) {
          alert("Failed to promote user. Try again later.");
          console.error(err);
        }
      });
  </script>
</body>
